CREATE TABLE Library (
    book_id NUMBER PRIMARY KEY,
    title VARCHAR2(100),
    author VARCHAR2(100)
);

CREATE TABLE Library_Audit (
    audit_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    book_id NUMBER,
    title VARCHAR2(100),
    author VARCHAR2(100),
    action VARCHAR2(10),
    action_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE OR REPLACE TRIGGER before_update_library
BEFORE UPDATE ON Library
FOR EACH ROW
BEGIN
    INSERT INTO Library_Audit (book_id, title, author, action)
    VALUES (:OLD.book_id, :OLD.title, :OLD.author, 'updated');
END;
/

CREATE OR REPLACE TRIGGER before_delete_library
BEFORE DELETE ON Library
FOR EACH ROW
BEGIN
    INSERT INTO Library_Audit (book_id, title, author, action)
    VALUES (:OLD.book_id, :OLD.title, :OLD.author, 'deleted');
END;
/

INSERT INTO Library (book_id, title, author) VALUES (1, 'The Guide', 'R.K. Narayan');
INSERT INTO Library (book_id, title, author) VALUES (2, 'Gitanjali', 'Rabindranath Tagore');
INSERT INTO Library (book_id, title, author) VALUES (3, 'Wings of Fire', 'A.P.J. Abdul Kalam');

COMMIT;

UPDATE Library SET title = 'The Guide - Revised' WHERE book_id = 1;

SELECT * FROM Library;

DELETE FROM Library WHERE book_id = 2;

SELECT * FROM Library;

SELECT * FROM Library_Audit;
